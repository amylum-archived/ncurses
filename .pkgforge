name 'ncurses'
org 'amylum'

license 'COPYING'

source(
  type: 'tar',
  url: 'https://invisible-mirror.net/archives/ncurses/current/ncurses-6.0-20171209.tgz',
  checksum: 'bb62f20cc81972a52df63f5396708d62ae0f374b72e26f32a306ef7f3c0e77f2'
)

configure_flags(
  prefix: '/usr',
  'with-termlib': 'tinfo',
  'with-ticlib': 'tic',
  'with-shared': nil,
  'with-normal': nil,
  'without-cxx': nil,
  'without-cxx-binding': nil,
  'enable-widec': nil
)

harden

build do
  configure
  make
  install

  def lib_link(lib, target)
    file = "#{releasedir}/usr/lib/lib#{lib}.so"
    File.open(file, 'w') { |fh| fh << "INPUT(#{target})" }
  end

  %w(ncurses form panel menu).each { |lib| lib_link(lib, "-l#{lib}w") }

  lib_link('cursesw', '-lncursesw')
  run "ln -s libncurses.so #{releasedir}/usr/lib/libcurses.so"

  rm "usr/lib/libncursesw.so"
  lib_link('ncursesw', 'libncursesw.so.6 -ltinfo')
end

test do
  run 'ncursesw6-config --version'
end
