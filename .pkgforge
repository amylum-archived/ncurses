name 'ncurses'
org 'amylum'

license 'COPYING'

source(
  type: 'tar',
  url: 'https://invisible-mirror.net/archives/ncurses/current/ncurses-6.0-20171014.tgz',
  checksum: '6bd5b15a0d64f65a2a84c60e7bebb8467cfd7312b886309c5ecd87ea5c441ace'
)

configure_flags(
  prefix: '/usr',
  'with-shared': nil,
  'with-normal': nil,
  'without-cxx': nil,
  'without-cxx-binding': nil,
  'enable-widec': nil
)

harden

build do
  configure
  make
  install

  %w(ncurses form panel menu).each do |lib|
    File.open("#{releasedir}/usr/lib/lib#{lib}.so", 'w') do |fh|
      fh << "INPUT(-l#{lib}w)"
    end
  end

  File.open("#{releasedir}/usr/lib/libcursesw.so", 'w') do |fh|
    fh << 'INPUT(-lncursesw)'
  end
  run "ln -s libncurses.so #{releasedir}/usr/lib/libcurses.so"

end

test do
  run 'ncursesw6-config --version'
end
